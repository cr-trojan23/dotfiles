var isDebug=!1,messages=[],manifest=chrome.runtime.getManifest();function isPositiveInteger(e){return/^\d+$/.test(e)}function compareVersionNumbers(e,t){function o(e){for(var t=0;t<e.length;++t)if(!isPositiveInteger(e[t]))return;return 1}var s=e.split("."),r=t.split(".");if(!o(s)||!o(r))return NaN;for(var n=0;n<s.length;++n){if(r.length===n)return 1;if(s[n]!==r[n])return s[n]>r[n]?1:-1}return s.length!=r.length?-1:0}chrome.runtime.onUpdateAvailable.addListener(function(e){console.log("updating to version "+e.version),chrome.runtime.reload()}),chrome.runtime.setUninstallURL("https://wawplus.com/uninstalled"),chrome.runtime.onInstalled.addListener(function(e){chrome.notifications.create("onInstalled",{title:"WA Web Plus "+manifest.version,message:chrome.i18n.getMessage("new_version_installed"),type:"basic",iconUrl:"../../icons/icon-128.png"}),"install"==e.reason&&chrome.tabs.create({url:"https://wawplus.com/changelog?v="+manifest.version}),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&chrome.tabs.reload(e[0].id)})}),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:reloadOrActivate()';"})})})}),chrome.tabs.onActivated.addListener(function(e){chrome.tabs.get(e.tabId,function(e){e.url&&e.url.includes("web.whatsapp.com")?chrome.browserAction.setPopup({popup:""}):chrome.browserAction.setPopup({popup:"/src/popup.html"})})}),chrome.runtime.onMessage.addListener(function(o,e,s){if(isDebug&&console.log("request",o),"setIcon"==o.type)chrome.browserAction.setIcon({path:o.icon});else if("setBadgeText"==o.type)chrome.browserAction.setBadgeText({text:o.title}),o.color?chrome.browserAction.setBadgeBackgroundColor({color:o.color||"#0000"}):chrome.browserAction.setBadgeBackgroundColor({color:"#0000"});else if("openChat"==o.type)chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:openChat("+o.phone+")';"})});else if("openSettings"==o.type)chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:initFrame(true)';"})});else{if("popupOpened"==o.type)return chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length?e[0].active?(s("close"),chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:initFrame()';"},function(){return!1})):chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:getUnreadMsgs()';"},function(){setTimeout(function(){s(messages)},500)}):(messages=[],s(void 0))}),!0;var t;if("setUnreadMessages"==o.type)messages=o.messages;else return"triggerWebhook"==o.type?(fetch(o.endpoint+"?"+o.params.toString(),{method:o.method||"get"}).then(function(e){return 200!==e.status?(isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e),s({isError:!0,response:e.status}),!1):void e.text().then(function(e){return isDebug&&console.log(e),s({isError:!1,response:e}),!0})}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")}),!0):"getOrder"==o.type?(fetch("https://wa-web-plus.web.app/get-order?checkout_id="+o.checkout_id).then(function(e){return e.json()}).then(function(e){isDebug&&console.log("fetchOrder orderDetails",e),s(e)}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")}),!0):void("getCRMLists"==o.type?"HubSpot"==o.software&&fetch("https://wa-web-plus.web.app/webhook?v="+Math.random()+"&method=get&link="+encodeURIComponent("https://api.hubapi.com/contacts/v1/lists?hapikey="+o.key)).then(function(e){200!==e.status?(isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e),alert("Error while connecting to server, please report this to the developers.")):e.json().then(function(s){isDebug&&console.log(s),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){var t,o;0<e.length&&(s.lists?(t="",o=[],s.lists.forEach(function(e,t){o.push({name:e.name,size:e.metaData.size,id:e.listId})}),isDebug&&console.log(o),t+='setCRMLists("'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+'")',chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:"+t+"';"})):chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:setCRMLists(false)';"}))})})}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")}):"saveContact"==o.type?"phone"==o.target?fetch("https://wa-web-plus.web.app/add-contact?v="+Math.random()+"&name="+encodeURIComponent(o.name)+"&phone="+o.phone+"&key="+o.key).then(function(e){200!==e.status?(isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e),alert("Error while connecting to server, please report this to the developers.")):e.json().then(function(t){isDebug&&console.log(t),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(1==t.saved?chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:cS(\"phone\")';"}):chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:cS(\"error-phone\")';"}))})})}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")}):"crm"==o.target&&"HubSpot"==o.software&&o.key&&(e=(t=(t=o.name||"").split(" "))[0]||"Unknown",t.shift(),t=t.join(" ")||"Unknown",fetch("https://wa-web-plus.web.app/webhook?v="+Math.random()+"&method=post&link="+encodeURIComponent("https://api.hubapi.com/contacts/v1/contact/?hapikey="+o.key)+"&data="+encodeURIComponent('{"properties":[{"property":"phone", "value":"'+o.phone+'"},{"property":"firstname","value":"'+e+'"},{"property":"lastname","value":"'+t+'"}]}')).then(function(e){200!==e.status?(isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e),alert("Error while connecting to server, please report this to the developers.")):e.json().then(function(t){isDebug&&console.log(t),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(t.properties?chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:cS(\"crm\")';"}):chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:cS(\"error-crm\")';"}))})})}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")})):"getCRMContacts"==o.type?"HubSpot"==o.software&&o.key&&fetch("https://wa-web-plus.web.app/webhook?v="+Math.random()+"&method=get&link="+encodeURIComponent("https://api.hubapi.com/contacts/v1/lists/"+o.list+"/contacts/all?hapikey="+o.key+"&count=100&property=phone&property=firstname&property=lastname")).then(function(e){200!==e.status?(isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e),alert("Error while connecting to server, please report this to the developers.")):e.json().then(function(s){isDebug&&console.log(s),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){var t,o;0<e.length&&s.contacts&&0<s.contacts.length&&(t="",o=[],s.contacts.forEach(function(e,t){o.push({firstname:e.properties&&e.properties.firstname?e.properties.firstname.value:"",lastname:e.properties&&e.properties.lastname?e.properties.lastname.value:"",phone:e.properties&&e.properties.phone?e.properties.phone.value:""})}),isDebug&&console.log(o),t+='setCRMTargets("'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+'")',chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:"+t+"';"}))})})}).catch(function(e){isDebug&&console.log("Fetch Error:",e),alert("Error while connecting to server, please report this to the developers.")}):"getServerValues"==o.type?fetch("https://wa-web-plus.web.app/status?v="+Math.random()).then(function(e){200!==e.status?isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e):e.json().then(function(t){isDebug&&console.log(t),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurRecentMessagesClass",value:t.blurRecentMessagesClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurRecentMessagesHoverClass",value:t.blurRecentMessagesHoverClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurContactsNamesClass",value:t.blurContactsNamesClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurContactsNamesHoverClass",value:t.blurContactsNamesHoverClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurContactsPhotosClass",value:t.blurContactsPhotosClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurContactsPhotosHoverClass",value:t.blurContactsPhotosHoverClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurConversationMessagesClass",value:t.blurConversationMessagesClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"blurConversationMessagesHoverClass",value:t.blurConversationMessagesHoverClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"contactListItemClass",value:t.contactListItemClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"containerClass",value:t.containerClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"sideHeaderClass",value:t.sideHeaderClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"headerButtonClass",value:t.headerButtonClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"footerButton1Class",value:t.footerButton1Class},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"footerButton2Class",value:t.footerButton2Class},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"footerButton3Class",value:t.footerButton3Class},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"contactStatusClass",value:t.contactStatusClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"statusV3DrawerButtonClass",value:t.statusV3DrawerButtonClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"statusV3DrawerHolderClass",value:t.statusV3DrawerHolderClass},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"rGroups",value:t.rGroups||[]},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"isEnough",value:t.isEnough||!1},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"isFlashSale",value:t.isFlashSale||!1},function(e){}),chrome.tabs.sendMessage(e[0].id,{action:"reInitValue",parameter:"globalMsg",value:t.globalMsg||!1},function(e){}))});try{var e;1==t.warning&&compareVersionNumbers(manifest.version.toString(),t.latest.toString())<0&&(e=chrome.i18n.getUILanguage(),e="es-419"==(e="en-US"==(e="ar en es pt_BR pt-BR tr fr ru".split(" ").includes(e)?e:"en")||"en-GB"==e?"en":e)?"es":e,void 0!==t.message[e]&&0<t.message[e].length?alert(t.message[e]):alert(t.message.en),t.link&&0<t.link.length&&chrome.tabs.create({url:t.link}))}catch(e){isDebug&&console.log(e)}return s(),!0})}).catch(function(e){isDebug&&console.log("Fetch Error:",e)}):"saveReference"==o.type?fetch("https://wa-web-plus.web.app/save-reference?t="+Math.random()+"&u="+o.obj+"&e="+chrome.runtime.id+"&v="+manifest.version+"&n="+manifest.name+"&l="+chrome.i18n.getUILanguage()):"addLicense"==o.type?(isDebug&&console.log(o),fetch("https://wa-web-plus.web.app/add-license?v="+Math.random()+"&timestamp="+o.timestamp+"&user="+o.user.toString()+"&product_id="+o.product+"&order="+o.order+"&referrer="+o.referrer+"&version="+manifest.version+"&language="+chrome.i18n.getUILanguage()).then(function(e){isDebug&&console.log(e)}).catch(function(e){isDebug&&console.log("Fetch Error:",e)})):"validateLicense"==o.type&&(isDebug&&console.log(o),e="","store"==o.source?e="https://wa-web-plus.web.app/validate-license?v="+Math.random()+"&timestamp="+o.timestamp+"&user="+o.user.toString()+"&product_id="+o.product+"&order="+o.order+"&referrer="+o.referrer+"&version="+manifest.version+"&language="+chrome.i18n.getUILanguage()+"&source=store&first="+o.first:"key"==o.source&&(e="https://wa-web-plus.web.app/validate-license?v="+Math.random()+"&key="+o.key+"&user="+o.user.toString()+"&referrer="+o.referrer+"&version="+manifest.version+"&language="+chrome.i18n.getUILanguage()+"&source=key&first="+o.first),fetch(e).then(function(e){isDebug&&console.log(e),200!==e.status?isDebug&&console.log("Looks like there was a problem. Status Code: "+e.status,e):e.json().then(function(t){isDebug&&console.log(t),null!=t&&(1==t.valid&&void 0!==t.product?chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&chrome.tabs.sendMessage(e[0].id,{action:"aP",product:t.product,time:o.timestamp||o.key,users:t.users,numbers:t.numbers,show:t.show,expiration:t.expiration},function(e){})}):0==t.valid&&"limit"==t.status&&void 0!==t.product?chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(chrome.tabs.sendMessage(e[0].id,{action:"dP",product:t.product,time:o.timestamp||o.key,status:"DISABLED",users:t.users,numbers:t.numbers,show:t.show,expiration:t.expiration},function(e){}),o.first&&chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:aM(\"something_is_wrong_with_your_license_key\")';"}))}):0==t.valid&&"expired"==t.status&&void 0!==t.product?chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(chrome.tabs.sendMessage(e[0].id,{action:"dP",product:t.product,time:o.timestamp||o.key,status:"EXPIRED",users:t.users,numbers:t.numbers,show:t.show,expiration:t.expiration},function(e){}),o.first&&chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:aM(\"something_is_wrong_with_your_license_key\")';"}))}):0==t.valid&&"invalid"==t.status&&(chrome.storage.local.remove("key"),chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},function(e){0<e.length&&(chrome.storage.local.remove("key"),chrome.tabs.executeScript(e[0].id,{code:"window.location.href='javascript:aM(\"something_is_wrong_with_your_license_key\")';"}))})))})}).catch(function(e){isDebug&&console.log("Fetch Error:",e)})))}});