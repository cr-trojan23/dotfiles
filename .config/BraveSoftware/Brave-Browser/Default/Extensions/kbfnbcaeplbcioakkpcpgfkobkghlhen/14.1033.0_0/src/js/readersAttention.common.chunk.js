(self.webpackChunk=self.webpackChunk||[]).push([[9923],{75003:(e,t,i)=>{i.d(t,{aH:()=>s,D$:()=>c,_z:()=>l});var s,a=i(90361),n=i(14601),o=i(78674),r=i(85985),h=i(38983);!function(e){let t,i,s,a;!function(e){e.default="default",e.emogenie="emogenie",e.readersAttention="readersAttention",e.readersAttentionHelp="readersAttentionHelp",e.feedback="feedback",e.settings="settings",e.proofitRequest="proofitRequest",e.proofitReview="proofitReview",e.popup="popup",e.startupPlaceholder="startupPlaceholder"}(t=e.Type||(e.Type={})),function(e){let t;!function(e){let t;!function(e){e.predictionWidget="predictionWidget",e.navigation="navigation",e.readersAttentionItem="readersAttentionItem"}(t=e.Type||(e.Type={}))}(t=e.Caller||(e.Caller={}))}(i=e.ReadersAttention||(e.ReadersAttention={})),function(e){let t;!function(e){e.headerButton="headerButton",e.descriptionLink="descriptionLink"}(t=e.Caller||(e.Caller={}))}(s=e.ReadersAttentionHelp||(e.ReadersAttentionHelp={})),function(e){let t;!function(e){e.none="none"}(t=e.Type||(e.Type={}))}(a=e.Popup||(e.Popup={})),e.isDefault=function(t){return t.type===e.Type.default},e.isEmogenie=function(t){return t.type===e.Type.emogenie},e.isReadersAttention=function(t){return t.type===e.Type.readersAttention},e.isReadersAttentionHelp=function(t){return t.type===e.Type.readersAttentionHelp},e.isFeedback=function(t){return t.type===e.Type.feedback},e.isSettings=function(t){return t.type===e.Type.settings},e.isProofitRequest=function(t){return t.type===e.Type.proofitRequest},e.isProofitReview=function(t){return t.type===e.Type.proofitReview},e.isPopup=function(t){return t.type===e.Type.popup},e.hasAlerts=function(e){switch(e.type){case t.default:case t.emogenie:case t.readersAttention:return!0;default:return!1}}}(s||(s={}));class c{constructor(e,t,i,c,l){this._defaultView=i,this.browser=l,this._sub=new n.w,this.viewHistory=[],this.isHeaderNavigationEnabled=h.h.create(!0).view(),this._activeView=h.h.create({type:s.Type.startupPlaceholder}),this._sub.add(e.subscribe((e=>{if(e.length>0)for(;!s.hasAlerts(this._activeView.get());)this.popActiveView()}))),c&&this._sub.add(t.pipe(o.b(100),r.h(a.fQ)).subscribe((()=>{if(c.has(this._activeView.get().type))for(;this._activeView.get().type!==this._defaultView.type;)this.popActiveView()})))}get activeView(){return this._activeView.view()}get lastView(){return this.viewHistory[this.viewHistory.length-1]||this._defaultView}pushActiveView(e){const t=this._activeView.get();e.type!==t.type&&(t.type!==s.Type.startupPlaceholder&&this.viewHistory.push(t),this._activeView.set(e))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;this._activeView.set(e)}replaceActiveView(e){e.type!==this._activeView.get().type&&this._activeView.set(e)}dispose(){this._sub.unsubscribe()}}class l extends c{constructor(e,t,i,a){super(t,i,{type:s.Type.default},new Set([s.Type.readersAttention,s.Type.emogenie]),a),this.isHeaderNavigationEnabled=this._activeView.view((e=>e.type!==s.Type.feedback)),this._sub.add(this._activeView.subscribe((t=>{switch(t.type){case s.Type.settings:return void e.assistantSettingsShow();case s.Type.proofitRequest:return void e.proofitRequestFormShow();default:return}})))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;e.type===s.Type.readersAttention&&(e.caller={type:s.ReadersAttention.Caller.Type.navigation}),this._activeView.set(e)}}},51308:(e,t,i)=>{i.r(t),i.d(t,{ReadersAttentionFeature:()=>j});var s=i(17771),a=i(57050),n=i(40327),o=i(2291),r=i(83078),h=i(5114),c=i(38983),l=i(75003),d=i(90361),p=i(15646);function g(e){switch(e){case l.aH.ReadersAttention.Caller.Type.predictionWidget:return"predictionWidget";case l.aH.ReadersAttention.Caller.Type.navigation:return"navigation";case l.aH.ReadersAttention.Caller.Type.readersAttentionItem:return"readersAttentionItem";default:(0,d.vE)(e)}}function u(e,t){switch(e.type){case l.aH.ReadersAttention.Caller.Type.predictionWidget:return t;case l.aH.ReadersAttention.Caller.Type.navigation:return"";case l.aH.ReadersAttention.Caller.Type.readersAttentionItem:return e.item.title;default:(0,d.vE)(e)}}class m{constructor(e,t,i,s){this._gnar=e,this._statistics=t,this._getAttentionScore=i,this._getSessionUuid=s,this._statsOnOpen=h.none}_getBasicOpenMetrics(e,t){return{textScore:o.T.prism.reverseGet(this._getAttentionScore()),numWords:this._statistics.wordsCount.get(),alertCounts:this._statistics.alertCounts.get(),launchSource:g(t.type),launchSourceLabel:u(t,e)}}onOpen(e,t,i,s){(0,n.pipe)(this._statsOnOpen,h.fold((()=>h.some({...this._getBasicOpenMetrics(t,s),numCards:i,checklist:e,time:performance.now(),numParagraphs:this._statistics.paragraphsCount.get(),numFormattingSpans:this._statistics.formattingSpansCount.get()})),(()=>h.none)),r.tap((e=>{const t=e.alertCounts.expandedViewSupported,s=e.alertCounts.freeClarity,a=e.alertCounts.critical,o=e.alertCounts.filter((e=>"priority"===e.assistantView)).expandedViewSupported,r=e.checklist.filter((e=>e.checked)).length;this._gnar.attentionPanelShow(Array.from(e.checklist),e.launchSource,e.launchSourceLabel,t,s,a,r,i.takeaway,o,i.nonTakeaway,e.numWords,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),e.textScore),this._statsOnOpen=h.some(e)})))}onClose(e,t){(0,n.pipe)(this._statsOnOpen,r.tap((i=>{const s=performance.now()-i.time,a=i.checklist.filter((e=>e.checked)).length,r=e.filter((e=>e.checked)).length;this._gnar.attentionPanelHide(Array.from(e),Array.from(i.checklist),this._statistics.wordsCount.get(),o.T.prism.reverseGet(this._getAttentionScore()),i.numWords,i.textScore,i.launchSource,i.launchSourceLabel,this._statistics.formattingSpansCount.get(),i.numFormattingSpans,r,a,t.takeaway,i.numCards.takeaway,this._statistics.paragraphsCount.get(),i.numParagraphs,t.nonTakeaway,i.numCards.nonTakeaway,s,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>"")))),this._statsOnOpen=h.none})))}onHelpScreenShow(e){this._gnar.attentionHelpScreenShow(e,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))))}onTakeawayUserAction(e,t,i,s){switch(i.type){case p.lY.Type.takeawayCorrectlyDetected:return this._gnar.attentionKeyTakeawayFeedbackClick((0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),s.end,s.start,t,"up");case p.lY.Type.takeawayIncorrectlyDetected:return this._gnar.attentionKeyTakeawayFeedbackClick((0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),s.end,s.start,t,"down");case p.lY.Type.takeawayDismiss:return this._gnar.attentionKeyTakeawayIgnored(e,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),s.end,s.start,t);case p.lY.Type.takeawayResolve:return this._gnar.attentionKeyTakeawayAcknowledged(e,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),s.end,s.start,t);default:(0,d.vE)(i)}}onKeyTakeawayCardShow(e,t){this._gnar.attentionKeyTakeawayCardShow((0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),t.end,t.start,e)}onChecklistItemExpand(e){this._gnar.attentionChecklistItemExpand(e.checked,e.id,e.numAlerts,(0,n.pipe)(this._getSessionUuid(),h.getOrElse((()=>""))),e.title)}}var f,_=i(14601),y=i(66310),w=i(76974),b=i(28043),v=i(85985),k=i(93508),C=i(93640),S=i(76331),x=i(34311),T=i(74850),I=i(77496),A=i(62337);!function(e){e.stitchAdjacent=function(e,t=1,i=.5,s=.5){const a=function(e,t=.5){const i=e.length>0?[{rects:[e[0]],top:e[0].rect.top,bottom:e[0].rect.top+e[0].rect.height}]:[];for(let s=1;s<e.length;++s){const a=i[i.length-1],n=e[s].rect;a.bottom-n.top>=t*Math.min(a.bottom-a.top,n.height)?(a.rects.push(e[s]),a.top=n.top<a.top?n.top:a.top,a.bottom=n.top+n.height>a.bottom?n.top+n.height:a.bottom):i.push({rects:[e[s]],top:n.top,bottom:n.top+n.height})}return i}(e,s);for(let e=0;e<a.length;++e){if(e>0){const t=a[e].top-a[e-1].bottom,s=a[e].bottom-a[e].top,n=a[e-1].bottom-a[e-1].top;t<Math.min(s,n)*i&&(a[e].top=a[e-1].bottom)}if(e<a.length-1){const t=a[e+1].top-a[e].bottom,s=a[e].bottom-a[e].top,n=a[e+1].bottom-a[e+1].top,o=.5*t;t<Math.min(s,n)*i&&(a[e].bottom=a[e].bottom+o)}for(let t=0;t<a[e].rects.length;++t)a[e].rects[t].rect={...a[e].rects[t].rect,top:a[e].top,height:a[e].bottom-a[e].top};for(let i=1;i<a[e].rects.length;++i){const s=a[e].rects[i-1].rect.left+a[e].rects[i-1].rect.width,n=a[e].rects[i].rect.left-s,o=.5*n;n>0&&n<Math.min(a[e].rects[i].rect.height,a[e].rects[i-1].rect.height)*t&&(a[e].rects[i-1].rect={...a[e].rects[i-1].rect,width:a[e].rects[i-1].rect.width+o},a[e].rects[i].rect={...a[e].rects[i].rect,left:s+o,width:a[e].rects[i].rect.left+a[e].rects[i].rect.width-s-o})}}return a.flatMap((e=>e.rects))},e.getMinDistanceBetween=function(e,t){if(A.UL.intersects(e,t))return 0;const i=e.left+e.width<t.left,s=e.top>t.top+t.height,a=e.left>t.left+t.width,n=e.top+e.height<t.top;return(i||a)&&(n||s)?1/0:i?t.left-(e.left+e.width):a?e.left-(t.left+t.width):n?t.top-(e.top+e.height):e.top-(t.top+t.height)},e.getBoundingBox=function(e){return e.slice(1).reduce(((e,t)=>{const i=Math.min(t.top,e.top),s=Math.min(t.left,e.left);return{top:i,left:s,width:Math.max(e.left+e.width,t.left+t.width)-s,height:Math.max(e.top+e.height,t.top+t.height)-i}}),e[0])}}(f||(f={}));var R=i(10760),M=i(25122);class H{constructor(e,t,i,s,a,n,o){this._geometryProvider=e,this._geometryLayout=t,this._textFieldRectInvalidated=i,this._formattingChanged=s,this._getTextMap=a,this._felog=o,this._highlightsCollection=new S.C(this._geometryProvider,this._geometryLayout,this._getTextMap,x.qH.everything,this._textFieldRectInvalidated,void 0,void 0,void 0,void 0,T.Y.create((0,I.w)(H.name)),this._felog.highlightGeometryUpdateTime),this._sub=new _.w,this.geometry=this._highlightsCollection.geometry.view(F),this._sub.add(n.subscribe((e=>this._onRangeChanges(e)))),this._sub.add(this._formattingChanged.subscribe((e=>{this._highlightsCollection.maintainConsistency([],(e=>e),!0)})))}_onRangeChanges(e){const t=this._felog.highlightUpdateTime.startMeasure();this._highlightsCollection.removeHighlights(e.removed.map(x.y$.Id.createFromMark)),"update"===e.kind&&(e.changed.forEach((e=>{this._highlightsCollection.updateHighlight(x.y$.Id.createFromMark(e.id),e.range,{intensity:e.intensity,range:e.range,isLocal:h.isSome(e.localInfo)})})),this._highlightsCollection.maintainConsistency(e.changed.map((e=>x.y$.Id.createFromMark(e.id))))),t.endMeasure()}dispose(){this._sub.unsubscribe(),this._highlightsCollection.dispose()}}function F(e){const t=function(e){const t=e.map((e=>({...e,boundingBox:f.getBoundingBox(e.rects)}))),i=[...t.slice(0,1).map((e=>({ranges:[e],boundingBox:e.boundingBox})))];for(const e of t.slice(1)){let t=!1;const s=1*R.C.mean(e.rects.map((e=>e.height)));for(let a=i.length-1;a>=0;--a){const n=i[a];if(f.getMinDistanceBetween(n.boundingBox,e.boundingBox)<=s&&n.ranges.some((t=>f.getMinDistanceBetween(t.boundingBox,e.boundingBox)<=s))){t=!0,n.boundingBox=f.getBoundingBox([n.boundingBox,e.boundingBox]),n.ranges.push(e);break}}t||i.push({ranges:[e],boundingBox:e.boundingBox})}return i.map((e=>e.ranges))}([...e.entries()].filter((e=>!!e[1])).map((([e,{rects:t,meta:{range:i,isLocal:s}}])=>({id:M.f.Range.Id.create(e),range:i,rects:t,isLocal:s}))).sort(((e,t)=>e.range.start-t.range.start))).map(((e,t)=>e.flatMap((({id:e,rects:i,isLocal:s})=>i.map((i=>({id:e,rect:i,groupIdx:t,isLocal:s}))))).map(((e,t)=>({...e,rectIdx:t}))))).flatMap((e=>f.stitchAdjacent(e))).reduce(((e,{id:t,rect:i,rectIdx:s,groupIdx:a,isLocal:n})=>{var o;return e.has(t)?null===(o=e.get(t))||void 0===o||o.rects.push({...i,rectIdx:s}):e.set(t,{id:t,rects:[{...i,rectIdx:s}],intensities:[],groupIdx:a,isLocal:n}),e}),new Map);for(const[i,s]of t.entries())s.intensities=V(e.get(x.y$.Id.createFromMark(i)).meta.intensity,s.rects);return t}function V(e,t){const[i,s]=e,a=(s-i)/t.reduce(((e,t)=>e+t.width),0),n=[];let o=i;for(const e of t){const t=e.width*a;n.push([o,o+t]),o+=t}return t.length>0&&(n[n.length-1][1]=s),n}class E{constructor(e,t,i,s,a,n,o,r){this._heatmapRangeManager=e,this._textChanges=t,this._geometryInvalidated=i,this._geometryProvider=s,this._geometryLayout=a,this._heatmapVisible=n,this._highlightsCollection=c.h.create(null),this._sub=new _.w,this.heatmapHighlights=this._highlightsCollection.pipe(y.w((e=>{var t;return null!==(t=null==e?void 0:e.geometry)&&void 0!==t?t:w.of(new Map)}))),this._sub.add(this._heatmapVisible.pipe(b.x()).subscribe((e=>{var t;null===(t=this._highlightsCollection.get())||void 0===t||t.dispose(),e&&this._highlightsCollection.set(new H(this._geometryProvider,this._geometryLayout,this._geometryInvalidated,this._textChanges.pipe(v.h((e=>C.x.isFormattingChange(e)||e.deltaChange.isEmpty))),o,this._heatmapRangeManager.heatmapChanges.pipe(k.O({kind:"update",removed:[],changed:this._heatmapRangeManager.heatmapRanges,textMap:o()})),r))})))}dispose(){var e;null===(e=this._highlightsCollection.get())||void 0===e||e.dispose(),this._sub.unsubscribe()}}var L=i(27378),O=i(5739),B=i(67521),P=i(2844),U=i(20491);const $=({heatmap:e,size:t,style:i,className:s,felog:a,debug:n=!1})=>{const o=L.useRef(null);return(0,B.A)(P.aj(e,t,((e,{width:t,height:i})=>{const s=null==a?void 0:a.canvasRenderTime.startMeasure(),r=o.current,h=null==r?void 0:r.getContext("2d");if(r&&h){r.width=t,r.height=i,h.clearRect(0,0,t,i);for(const t of e.values())t.rects.forEach(((e,i)=>{D(h,t,e,t.intensities[i],n)}));null==s||s.endMeasure()}else null==s||s.cancelMeasure()}))),L.createElement("canvas",{ref:o,style:i,className:s,"data-grammarly-part":"heatmap"})};function D(e,t,i,s,a){const[n,o]=U.a.toColors(s);if(n!==o){const t=e.createLinearGradient(i.left,0,i.left+i.width,0);t.addColorStop(0,n),t.addColorStop(1,o),e.fillStyle=t}else e.fillStyle=n;if(e.fillRect(i.left,i.top,i.width,i.height),a){e.strokeStyle="black",e.lineWidth=1,e.strokeRect(i.left,i.top,i.width,i.height);const s=`${t.id}-${t.groupIdx}-${i.rectIdx}`,a=12;e.font=`normal normal bold ${a}px Arial`,e.fillStyle="white",e.fillRect(i.left+1,i.top+i.height-1-a,Math.min(i.width,e.measureText(s).width),Math.min(i.height,a)),e.fillStyle="red",e.fillText(s,i.left+1,i.top+i.height-1)}}var W=i(77176);const N=({heatmap:e,className:t,style:i,debug:s})=>L.createElement(O.F.div,{className:t,style:i},e.pipe((0,W.U)((e=>Array.from(e.values()).flatMap((e=>e.rects.map(((t,i)=>({...t,intensity:e.intensities[i],id:`${e.id}-${i}`,highlightId:e.id,groupIdx:e.groupIdx,isLocal:e.isLocal}))))).map((e=>L.createElement("div",{"data-name":"heatmap-range",...s?{"data-highlight-id":e.highlightId,"data-group-idx":e.groupIdx,"data-rect-idx":e.rectIdx}:{},key:e.id,style:{position:"absolute",width:e.width,height:e.height,left:e.left,top:e.top,background:q(e.intensity),...s?{border:"1px solid "+(e.isLocal?"red":"black")}:{}}})))))));function q(e){const[t,i]=U.a.toColors(e);return`linear-gradient(to right, ${t}, ${i})`}var Y=i(23866);class K{constructor(e,t,i,s,a){this._useHeatmapCanvas=e,this._heatmapHighlights=t,this._visible=i,this._textFieldLayout=s,this._felog=a,this._debug=!1}get view(){return L.createElement(O.F.Fragment,null,this._visible.view((e=>e?this._useHeatmapCanvas?L.createElement($,{debug:this._debug,felog:this._felog,heatmap:this._heatmapHighlights,size:this._textFieldLayout.scrollSize.behavior,className:Y.heatmap}):L.createElement(N,{debug:this._debug,heatmap:this._heatmapHighlights,className:Y.heatmap}):null)))}}var G=i(84966);class z{constructor(){this._takeawaysFeedback=new Map,this._log=T.Y.create("TakeawayFeedbackStore")}registerFeedback(e,t){this._takeawaysFeedback.get(e)!==t&&(this._takeawaysFeedback.set(e,t),this._log.debug(`Feedback "${t}" stored for alert #${e}]`))}deleteFeedback(e){this._takeawaysFeedback.delete(e),this._log.debug(`Removed feedback for alert #${e}`)}get addFeedbackToRawAlertTransformer(){return e=>{if(G.wQ.isTakeaway(e)){const t=this._takeawaysFeedback.get(e.id);return t?{...e,extra_properties:{...e.extra_properties,takeawayFeedback:t}}:e}return e}}}class j{constructor(e,t,i,s,a,n,r,l,d,p,g,u,f){this._heatmapRangeManager=e,this._useHeatmapCanvas=t,this._textObserver=i,this._geometryInvalidated=s,this._geometryProvider=a,this._geometryLayout=n,this._textFieldLayout=r,this._getSessionUuid=l,this._gnar=d,this._felog=p,this._statistics=g,this._isReadersAttentionItemSupported=u,this._experiments=f,this.heatmapVisible=c.h.create(!1),this._heatmapReceived=c.h.create(!1),this._messages=c.h.create(h.none),this._rawChecklist=c.h.create({wordsCount:0,items:new Map}),this._heatmapHighlightsWiring=new E(this._heatmapRangeManager,this._textObserver.contentChanges.async,this._geometryInvalidated,this._geometryProvider,this._geometryLayout,this.heatmapVisible,(()=>this._textObserver.getCurrentTextMap()),this._felog.attentionHeatmap),this._heatmapViewController=new K(this._useHeatmapCanvas,this._heatmapHighlightsWiring.heatmapHighlights,this.heatmapVisible,this._textFieldLayout,this._felog.attentionHeatmap),this._feedItemDismissed=!1,this._attentionScoreInfo=c.h.create(h.none),this._feedItemInfo=c.h.create(h.none),this._attentionScore=c.h.create(o.T.unsafeFromNumber(0)),this._hidden=c.h.create(!1),this.rawChecklist=this._rawChecklist.view(),this.tracking=new m(this._gnar,this._statistics,(()=>this._attentionScore.get()),(()=>this._getSessionUuid())),this.attentionScoreInfo=this._attentionScoreInfo.view(),this.feedItemInfo=c.h.combine(this._hidden,this._feedItemInfo,((e,t)=>e?h.none:t)),this.takeawaysFeedbackStore=new z,this.heatmapView=this._heatmapViewController.view,this.heatmapReceived=this._heatmapReceived.view(),this.messages=this._messages.view(),this.hidden=this._hidden.view()}get addFeedbackToRawAlertTransformer(){return this.takeawaysFeedbackStore.addFeedbackToRawAlertTransformer}onDismissFeedItem(){this._feedItemDismissed=!0,this._feedItemInfo.set(h.none)}onAttentionHeatmapMessage(e){this._heatmapReceived.set(!0),(0,n.pipe)(e.attentionScore,r.tap((e=>this._attentionScore.set(e)))),(0,n.pipe)(s.Y(h.option)({attentionScore:e.attentionScore,showAttentionCard:e.showAttentionCard}),h.filter((()=>{var e;return!0===(null===(e=this._experiments)||void 0===e?void 0:e.attentionScoreCard)&&this._isReadersAttentionItemSupported})),h.fold((()=>{this._attentionScoreInfo.set(h.none),this._feedItemInfo.set(h.none)}),(({attentionScore:e,showAttentionCard:t})=>{this._attentionScoreInfo.set(h.some({attentionScore:e,description:"Highlighted text is more likely to be read"})),this._feedItemDismissed||this._feedItemInfo.modify((0,a.flow)(h.map((t=>({...t,attentionScore:e}))),h.alt((()=>t?h.some({title:"Capture your reader's attention",description:"Highlighted text is more likely to be read",details:h.some("Grammarly predicts where readers may lose focus by comparing the complexity of a sentence to the information it contains. The prediction also considers the length and formatting of the email as a whole."),attentionScore:e}):h.none))))})))}onAttentionInfoMessage(e){const t=new Map(this._rawChecklist.get().items);e.checklist.forEach((e=>t.set(e.id,e))),this._rawChecklist.set({wordsCount:e.wordsCount,items:t}),this._messages.set(h.some({headerMessage:e.headerMessage,predictionMessage:e.predictionMessage})),this._hidden.set(e.hidden)}dispose(){this._heatmapHighlightsWiring.dispose()}}},23866:e=>{e.exports={heatmap:"_2rx7l",fadeIn:"_3nM-b"}}}]);