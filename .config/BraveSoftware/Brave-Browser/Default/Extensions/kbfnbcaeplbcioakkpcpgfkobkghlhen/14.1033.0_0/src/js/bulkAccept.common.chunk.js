(self.webpackChunk=self.webpackChunk||[]).push([[4104],{35706:(e,t,s)=>{s.r(t),s.d(t,{BulkAcceptFeature:()=>A,BulkAcceptUIController:()=>q});var i,l=s(36991),n=s(84966),r=s(73975);!function(e){let t,s;!function(e){e.Retain="retain",e.Delete="delete",e.Insert="insert"}(t=e.Type||(e.Type={})),e.isDelete=function(t){return t.type===e.Type.Delete},e.isInsert=function(t){return t.type===e.Type.Insert},function(e){e.eq=r.getStructEq({type:r.eqString,textChunk:r.eqString})}(s=e.NoInvert||(e.NoInvert={}))}(i||(i={}));var c=s(5114),a=s(22764),o=s(40327),u=s(41398),p=s(90361),d=s(23830),m=s(17404),h=s(44071),_=s(8482),k=m.S.isCapiAlert,b=m.S.isSuperCapiAlert;const f=e=>`${e.transformText}>>>${JSON.stringify(e.replacements)}`,v=(e,t)=>{const s=[],n=e.transformText,r=e.replacements[0];return _.$.hasTransformJSON(e)&&(0,o.pipe)(e.transformJSON.alternatives,c.fold(p.EI,(e=>{const c=t.getPlainText().substring(e.context[0].s,e.context[0].e);let a=0;e.alternatives[0].ops.forEach((e=>{switch(!0){case l.s.isRetain(e)&&["optional","important"].includes(e.type):s.push({type:i.Type.Retain,textChunk:c.substring(a,a+=e.retain),invertedChunk:""});break;case l.s.isInsert(e)&&["optional"].includes(e.type):s.push({type:i.Type.Retain,textChunk:e.insert,invertedChunk:""});break;case l.s.isInsert(e)&&["main"].includes(e.type):s.push({type:i.Type.Insert,textChunk:r,invertedChunk:n});break;case l.s.isDelete(e)&&["main"].includes(e.type):a+=e.delete,s.push({type:i.Type.Delete,textChunk:n,invertedChunk:r})}}))}))),s};class g{constructor(e,t,s,i){this._alertProcessor=e,this._textObserver=t,this._replacementService=s,this._checkingService=i,this._alertsInBulk=new Map,this._dismissed=new Map,this._subs=[],this._revision="",this._subs.push(this._alertProcessor.alerts.changes.subscribe((e=>{this._dismissed.size&&e.addedAlerts.forEach((e=>{[...this._dismissed.entries()].some((([t,s])=>!(!k(e)||b(e)||f(e)!==s)&&(this._checkingService&&this._checkingService.onAlertIgnored(e,n.e3.Inline),this._alertProcessor.removeAlert(e.id,{_tag:d.i.alertAccepted}),!0)))}))})))}getAlertsInBulk(){return this._alertsInBulk}async applyAlerts(){const e=Array.from(this._alertProcessor.alerts.getAll()).filter((e=>!(!k(e)||b(e))&&("inline"===e.inline&&e.replacements.length))).sort(((e,t)=>e.transformRange.start>t.transformRange.start?1:-1));if(!e.length)return!1;const t=this._textObserver.getCurrentTextMap().getPlainText();let s=0;const i=[];e.forEach(((e,l)=>{var n;this._revision=e.revision;const r=null!==(n=e.replacements[0])&&void 0!==n?n:"",c=t.substring(e.transformRange.start,e.transformRange.end),a={start:e.transformRange.start+s,end:e.transformRange.start+r.length+s};this._alertsInBulk.set(e.id,{diff:v(e,this._textObserver.getCurrentTextMap()),isUndone:!1,undoReplacement:{pos:a,value:c},alertHash:f(e)});const o=p.iy.create().slice(0,6);i.push({_tag:m.b.bulkAccept,id:`${o}-${l}`,state:h.K.applied,highlightRanges:[a],highlightTexts:[r],transformText:r,transformRange:a,revision:this._revision,replacement:c,context:""}),s+=r.length-c.length}));const l=e.slice(0).reverse();return await this._replacementService.performBatchReplacements(l.map((e=>({pos:e.transformRange,value:e.replacements[0]})))),i.forEach((e=>this._alertProcessor.addAlert(e))),!0}undoReplacement(e){let t=null;this._alertsInBulk.forEach(((s,i)=>{null!==t?this._alertsInBulk.set(i,{...s,undoReplacement:{...s.undoReplacement,pos:{start:s.undoReplacement.pos.start+t,end:s.undoReplacement.pos.end+t}}}):e===i&&(this._dismissed.set(i,s.alertHash),t=s.undoReplacement.value.length-(s.undoReplacement.pos.end-s.undoReplacement.pos.start),this._alertsInBulk.set(i,{...s,isUndone:!0}),this._replacementService.performReplacement(s.undoReplacement.pos,s.undoReplacement.value,!1))}))}undoAll(){[...this._alertsInBulk.values()].reverse().forEach((e=>{e.isUndone||this._replacementService.performReplacement(e.undoReplacement.pos,e.undoReplacement.value,!1)}))}clear(){this._alertsInBulk.clear()}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}class A{constructor(e,t,s,i,l,n,r,c,o,p,d){this._textObserver=e,this._replacementService=t,this._checkingService=s,this._controller=i,this._keyDown=l,this._gnar=n,this._state=r,this._isCurrentFieldFocused=c,this._alertProcessor=o,this._setBulkAcceptSimplifiedConfirmation=p,this._updateBulkAcceptShortcutUsageCounter=d,this._subs=[],this._bulkReplacement=new g(this._alertProcessor,this._textObserver,this._replacementService,this._checkingService),this._subs.push(this._keyDown.pipe((0,u.M)(this._isCurrentFieldFocused)).subscribe((async([e,t])=>{var s,i,l,n;const r=(0,a.O)();switch(!0){case t&&(e=>"KeyG"===e.code&&(r.config.systemInfo.os.isMac?e.ctrlKey:e.altKey))(e):if(await this._bulkReplacement.applyAlerts()){const e=null!==(i=null===(s=this._state.get())||void 0===s?void 0:s.page.bulkAcceptShortcutUsageCounter)&&void 0!==i?i:0;-1!==e&&this._updateBulkAcceptShortcutUsageCounter(e+1);const t=null!==(n=null===(l=this._state.get())||void 0===l?void 0:l.page.bulkAcceptSimplifiedConfirmation)&&void 0!==n&&n;this._controller.show({isSimplifiedConfirmation:t,isFullViewForced:!1,alertsInBulk:this._bulkReplacement.getAlertsInBulk(),undoReplacement:e=>{this._bulkReplacement.undoReplacement(e),this._gnar.bulkAcceptCorrectionUndo()},undoAll:()=>{this._bulkReplacement.undoAll(),this._gnar.bulkAcceptAllCorrectionsUndo(),this._close()},close:()=>{this._close()},setBulkAcceptSimplifiedConfirmation:e=>{this._setBulkAcceptSimplifiedConfirmation(e)}}),this._gnar.bulkAcceptShortcutUsed()}break;case t&&(e=>"KeyZ"===e.code&&(r.config.systemInfo.os.isMac?e.metaKey:e.ctrlKey))(e)&&Boolean(this._bulkReplacement.getAlertsInBulk().size):e.preventDefault(),this._bulkReplacement.undoAll(),this._close()}})),this._isCurrentFieldFocused.subscribe((e=>{e||this._close()})))}_close(){this._controller.hide(),this._bulkReplacement.clear()}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._bulkReplacement.dispose()}}var C=s(38983),x=s(27378),E=s(32952),y=s(93508),S=s(28043),w=s(77176),R=s(36346),I=s(12187),B=s(8125),N=s(71249),T=s(88702),M=s(50924),F=s(44060),D=s(63969);const U=D.u.style({display:"flex",flexGrow:2,lineHeight:D.u.rem(1.315),flexWrap:"wrap"}),O={padding:0,whiteSpace:"pre-wrap"},W=D.u.style(O),V=D.u.style(Object.assign({color:F.Il.CoreGreen60},O)),H=D.u.style(Object.assign(Object.assign({},O),{color:F.Il.CoreRed50,textDecoration:"line-through",$nest:{[`& + .${V}`]:{marginLeft:D.u.rem(.25)}}})),P=D.u.style({fontWeight:"bolder",textDecoration:"none",paddingLeft:"1px",paddingRight:"1px",$nest:{[`&.${V}`]:{backgroundColor:F.Il.CoreGreen10},[`&.${H}`]:{backgroundColor:F.Il.CoreRed10}}}),L=e=>x.createElement("div",{className:U},(0,o.pipe)(e.diff,N.mapWithIndex(((e,t)=>(0,B.or)(i.isDelete(t),i.isInsert(t))?x.createElement("div",Object.assign({key:e},(0,I.Sh)(i.isDelete(t)?H:V,(0,B.or)((0,M.BE)(t.textChunk),(0,M.FD)(t.textChunk))&&P)),x.createElement(T.sR,{newText:t.textChunk,oldText:t.invertedChunk})):x.createElement("div",{key:e,className:W},t.textChunk))))),$=()=>x.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x.createElement("path",{d:"M1 3.5H3M15 3.5H13M13 3.5L12.1528 13.6661C12.0664 14.7027 11.1999 15.5 10.1597 15.5H5.84027C4.80009 15.5 3.93356 14.7027 3.84717 13.6661L3 3.5M13 3.5H10.5M3 3.5H5.5M5.5 3.5V2C5.5 1.17157 6.17157 0.5 7 0.5H9C9.82843 0.5 10.5 1.17157 10.5 2V3.5M5.5 3.5H10.5M9.5 6.5V12M6.5 6.5V12",stroke:"#6D758D",strokeLinecap:"round",strokeLinejoin:"round"})),j=()=>x.createElement("svg",{width:"16",viewBox:"0 0 24 24"},x.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"none"},x.createElement("circle",{cx:"12",cy:"12",r:"11.5",fill:"#00CDA3"}),x.createElement("path",{stroke:"#FFF",strokeWidth:"2",d:"M7.54 12.81l3.343 3.5 6.657-7.78",strokeLinecap:"round"}))),G=({isSimplifiedConfirmation:e,alertsInBulk:t,undoReplacement:s,undoAll:i,close:l,setBulkAcceptSimplifiedConfirmation:n})=>{const[r,c]=x.useState({}),[a,o]=x.useState(e);return x.createElement("div",{"data-grammarly-part":"bulk-accept-confirmation",className:R.bulkAccept},x.createElement("div",{className:R.bulkAccept_title},x.createElement("div",{className:R.bulkAccept_title_sparkles}),x.createElement("div",{className:R.bulkAccept_title_text},"You've made ",t.size-Object.keys(r).length," instant corrections")),x.createElement("div",{className:R.bulkAccept_list},[...t.entries()].filter((([e])=>!r[e])).map((([e,t])=>x.createElement("div",{className:R.bulkAccept_list_row,key:e},x.createElement("div",{className:R.bulkAccept_list_row_checkbox},x.createElement(j,null)),x.createElement("div",{className:R.bulkAccept_list_row_suggestion},x.createElement(L,{diff:t.diff})),x.createElement("div",{className:R.bulkAccept_list_row_undo,onClick:t=>{s(e),c({...r,[e]:!0})}},x.createElement($,null)))))),x.createElement("div",{className:R.bulkAccept_btnWrapper},x.createElement("div",{"data-grammarly-part":"ok-button",className:R.bulkAccept_btnWrapper_confirm,onClick:e=>l()},"Looks good"),x.createElement("div",{"data-grammarly-part":"undo-button",className:R.bulkAccept_btnWrapper_undo,onClick:e=>i()},x.createElement("div",{className:R.bulkAccept_btnWrapper_undo_text},"Undo all"),x.createElement("div",{className:R.bulkAccept_btnWrapper_undo_key},"⌘ Z"))),x.createElement("div",{className:R.bulkAccept_confirmation},x.createElement("div",null,x.createElement("input",{type:"checkbox",defaultChecked:a,onChange:e=>{o(e.currentTarget.checked),n(e.currentTarget.checked)}})),x.createElement("div",null,"Next time, don’t ask for confirmation.")))},K=({alertsInBulk:e,undoAll:t,forceFullView:s})=>x.createElement("div",{className:R.bulkAcceptSimplified},x.createElement("div",{className:R.bulkAcceptSimplified_text},"You’ve accepted"," ",x.createElement("span",{className:R.bulkAcceptSimplified_text_counter,onClick:e=>{s()}},e.size," suggestions.")),x.createElement("div",{className:R.bulkAcceptSimplified_shortcut,onClick:e=>t()},x.createElement("div",{className:R.bulkAcceptSimplified_shortcut_text},"Undo"),x.createElement("div",{className:R.bulkAcceptSimplified_shortcut_key},"⌘ Z")));class q{constructor(){this._hovered=new E.xQ,this._dismissed=new E.xQ,this.cardHovered=this._hovered.pipe((0,y.O)(!1),(0,S.x)()),this.cardDismissed=this._dismissed.pipe((0,S.x)()),this._activeCardModel=C.h.create(null),this.view=this._activeCardModel.pipe((0,w.U)((e=>e?x.createElement(G,{...e}):null))),this.getView=e=>this._activeCardModel.pipe((0,w.U)((t=>{switch(clearTimeout(this._autocloseTimeout),!0){case"full"===e&&t&&(!t.isSimplifiedConfirmation||t.isFullViewForced):return x.createElement(G,{...t});case"simplified"===e&&t&&t.isSimplifiedConfirmation&&!t.isFullViewForced:return this._autocloseTimeout=setTimeout(this._dismiss.bind(this),4e3),x.createElement(K,{...t,forceFullView:()=>this._forceFullView()});default:return null}})))}_dismiss(){this._activeCardModel.set(null)}_forceFullView(){const e=this._activeCardModel.get();this._activeCardModel.set({...e,isFullViewForced:!0})}show(e){this._activeCardModel.set(e)}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}isVisible(){return!!this._activeCardModel.get()}dispose(){this.hide()}}},5498:(e,t,s)=>{s.r(t),s.d(t,{BulkAcceptUndoCard:()=>o});var i=s(27378),l=s(46547),n=s(88326),r=s(12187),c=s(5739),a=s(13600);const o=e=>{const t=()=>i.createElement("div",{className:a.buttonRow,key:"buttons"},i.createElement(n.M,{dataGrammarlyPart:"ok-button",clickHandler:()=>e.onAcceptClick()},i.createElement("div",{...(0,r.Sh)(a.button,a.acceptButton)},"Looks good")),i.createElement(n.M,{dataGrammarlyPart:"revert-button",clickHandler:()=>e.onRejectClick()},i.createElement("div",{...(0,r.Sh)(a.button,a.rejectButton)},"Revert to ",i.createElement("span",{className:a.originalText},e.originalText||'""'))));return i.createElement(l.Z,{kind:"inline-fit-content"},i.createElement("div",{className:a.bulkAcceptCard},i.createElement((()=>i.createElement(c.F.Fragment,null,i.createElement("div",{className:a.footerCaption},i.createElement("div",{className:a.footerCaption_sparkles}),i.createElement("div",{className:a.footerCaption_text},"Instantly corrected")),i.createElement(t,null))),null)))}},13600:e=>{e.exports={bulkAcceptCard:"_2u8Lc",footerCaption:"_21Z_d",footerCaption_sparkles:"dlslv",footerCaption_text:"_1Ue2H",buttonRow:"_1GPsh",button:"_3pBBY",acceptButton:"owvts",rejectButton:"WibOy",originalText:"_27CUg",listItem:"_2UVpv",buttonWrap:"_1Y8Pc",icon:"_3k3hh",caption:"Myuhr"}},36346:e=>{e.exports={bulkAccept:"_3aIJb",bulkAccept_title:"d_Hup",bulkAccept_title_sparkles:"_30ax7",bulkAccept_title_text:"_Ex0B",bulkAccept_list:"_1EKCC",bulkAccept_list_row:"_1qiqt",bulkAccept_list_row_checkbox:"_3dcFO",bulkAccept_list_row_suggestion:"ThM-s",bulkAccept_list_row_undo:"_302di",bulkAccept_btnWrapper:"_10DDN",bulkAccept_btnWrapper_confirm:"_1GS3W",bulkAccept_btnWrapper_undo:"_2l-R3",bulkAccept_btnWrapper_undo_text:"_1As23",bulkAccept_btnWrapper_undo_key:"_3TlLp",bulkAccept_confirmation:"_1Diqs",bulkAcceptSimplified:"_2mAxL",bulkAcceptSimplified_text:"_2xBcy",bulkAcceptSimplified_text_counter:"_2PgcU",bulkAcceptSimplified_shortcut:"_2eVmT",bulkAcceptSimplified_shortcut_text:"b1rSn",bulkAcceptSimplified_shortcut_key:"_2wtU8"}}}]);