(self.webpackChunk=self.webpackChunk||[]).push([[7272],{80864:(e,t,i)=>{i.d(t,{O:()=>G});var s=i(57050),a=i(35214),n=i(40327),r=i(54483),o=i(31820),l=i(35108),d=i(77176),c=i(40151),u=i(2834),m=i(55415),p=i(22232),h=i(5114),g=i(32821),S=i(27378),v=i(30763),y=i(7046),f=i(21474),C=i(3656),b=i(28706),I=i(84313),A=i(15646),k=i(74754),w=i(66346),_=i(76974),E=i(5739),R=i(16314),q=i(35501),T=i(35630),F=i(32585);const O=g.UI.Node.make((({state:e,notify:t})=>{const i=S.useContext(v.m.Context);return S.createElement(E.F.Fragment,null,e.pipe(d.U((e=>(0,s.pipe)(e.details,h.fold((()=>S.createElement("div",null)),(()=>S.createElement(y.zx.Tertiary,{key:"toggle-more",name:(0,w.hC)(e.visualState,i),title:(0,w.hC)(e.visualState,i),onClick:b.hz(t({type:A.eI.Kind.startTransitionTo,id:e.id,transition:{type:I.X.isCardOpen(e.visualState)?"focused":"expanded",clockwise:!0}}))},I.X.isCardOpen(e.visualState)?S.createElement(f.JO.Arrow,{key:"more",className:F.lessIcon}):S.createElement(f.JO.QuestionMark,{key:"expand"}),(0,w.hC)(e.visualState,i)))))))))})),U=g.UI.Node.make((({notify:e})=>S.createElement(y.zx.Tertiary,{name:"dismiss",title:"Dismiss",onClick:b.hz(e({type:R.Dy.ignoreButtonClick}))},S.createElement(f.JO.Ignore,null)))),B=g.UI.Node.make((({state:e})=>S.createElement(E.F.Fragment,null,e.pipe(d.U((e=>(0,s.pipe)(e.details,h.fold(s.constNull,(t=>S.createElement(w.G3,{key:"card-actions-details",visualState:e.visualState,className:F.more},S.createElement(C.XY,{className:F.minimalDescription,...k.y.renderToHtml(t)}))))))))))),N=g.UI.Node.make((({notify:e})=>S.createElement(y.zx.Flat,{className:F.feedbackFooter,name:"attention-score-card-open-feedback-form",onClick:b.hz(e({type:R.Dy.feedbackButtonClick}))},S.createElement("span",null,"Anything we can improve?"),S.createElement(f.JO.SmartPhrases.OpenFeedbackFormArrow,null)))),x=g.UI.Node.make((({state:e,notify:t})=>S.createElement(E.F.Fragment,null,e.pipe(d.U((e=>S.createElement(y.zx.Primary,{name:"readersAttentionItem-view-more",onClick:b.hz(t({type:R.Dy.viewMoreButtonClick,item:e})),className:F.viewMoreButton},"See suggestions"))))))),D=g.UI.Knot.make(g.UI.Grid.make((({slots:e})=>S.createElement(E.F.div,{className:T.card,"data-name":"attention-score-card-full"},e.header,S.createElement(E.F.div,{className:F.cardBody},e.content,e.details,S.createElement("div",{className:F.actions},e.viewMoreButton)),S.createElement(E.F.div,{className:F.actionsFooter},e.expandButton,e.dismissButton),e.feedbackFooter))),{header:(0,q.h)("full"),content:q.r,details:B,expandButton:O,dismissButton:U,viewMoreButton:x,feedbackFooter:N}),P=e=>g.Z.composeKnot({header:()=>e,content:()=>e.pipe(d.U((e=>({attentionScore:e.attentionScore,description:e.description})))),details:()=>e,expandButton:()=>e,dismissButton:()=>_.of(null),viewMoreButton:g.Z.fromSideEffect(s.constVoid,e),feedbackFooter:()=>_.of(null)});var Q=i(12187),H=i(65060),M=i(11510);const X=g.UI.Knot.make(g.UI.Grid.make((({slots:e,notify:t})=>S.createElement(E.F.div,{"data-name":"attention-score-card-mini",onClick:b.hz(t({type:R.Dy.miniCardClick,id:H.g.id})),...(0,Q.Sh)(T.card,M.miniCard)},e.header))),{header:(0,q.h)("mini")}),V=e=>g.Z.composeKnot({root:g.Z.fromSideEffect(s.constVoid,null),header:()=>e});var W;!function(e){const t=g.UI.Union.make("kind",{mini:X,full:D,hidden:g.UI.Node.empty}),i=e=>({mini:V(e.pipe(d.U((e=>({title:e.view.title,attentionScore:e.view.attentionScore,density:e.density}))))),full:P(e.pipe(d.U(m.pick("view")))),hidden:()=>c.E}),a=r.G.make(t);function n(e){switch(e){case"added":case"rendered":return"mini";case"focused":case"expanded":return"full";case"hidden":case"removed":return"hidden";case"presuccess":case"success":case"feedback_form":case"muted":throw new Error(`${e} is not supported for ReadersAttentionCard`);default:(0,p.vE)(e)}}e.Card=g.UI.Node.make((({state:e,notify:t})=>g.UI.mount(a,(0,s.pipe)(o.g.flow(e.pipe(d.U(m.pick("view"))),(0,s.pipe)((e=>g.Z.composeUnion(i(e),(()=>e.pipe(d.U((e=>({kind:n(e.view.visualState.transition.type)})))))))(e),g.Z.extendActions(u.b((e=>t(e.action.action)())))),(e=>g.Z.composeUnion(i(e),(()=>e.pipe(d.U((e=>({kind:(0,s.pipe)(e.view.visualState.from,h.fold((()=>"mini"),n))})))))))(e),m.pick("id"),l.CE.toOption(l.a)),o.g.extend((e=>t(e)()))))))}(W||(W={}));var G,L=i(20153),z=i(66896),Y=i(52741),K=i(7910),J=i(49978),Z=i(84974),$=i(98752),j=i(17594),ee=i(91549),te=i(20594),ie=i(86775),se=i(75316),ae=i(16892),ne=i(48521),re=i(15215),oe=i(70100),le=i(47306),de=i(35416),ce=i(25975),ue=i(8125),me=i(83078),pe=i(73975),he=i(45701),ge=i(31881);!function(e){function t(e,t,i,s,a){return de.nL.Items.mapper((e=>e.kind),{[I.X.Kind]:e,[ee.R.Kind]:t,[oe.X.kind]:i,[le.J.kind]:s,[H.g.kind]:a})}function i(e){return e.kind===I.X.Kind}function r(e){return e.kind===ee.R.Kind}function o(e){return i(e)&&se.C.isEthicalAIItem(e)}function l(e){return r(e)&&se.C.isEthicalAIItem(e)}function d(e,i){return{viewState:(s,a)=>t((t=>({view:t,isLastCard:s,kind:"alertCard",visibleViewportHeight:e(a)})),(t=>({view:t,isLastCard:s,kind:"alertsBundle",visibleViewportHeight:e(a)})),(e=>({view:e,kind:"checklistItemEmpty"})),(t=>({view:t,kind:"checklistItemWithAlerts",isLastCard:s,visibleViewportHeight:e(a)})),(e=>({density:i()===z.R.SpecialId.AllAlerts?"normal":"compact",view:e,kind:"readersAttentionItem"})))}}e.isSelectableWithAlertItem=(0,ue.Kg)(i,r,re.d.isChecklistItemWithAlerts),e.getActiveItemWithAlert=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveAlignableItem=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveFocusableItem=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.checksFeedItemsMapper=t,e.isAlertCard=i,e.isAlertsBundle=r,e.isEthicalAIAlertCard=o,e.isEthicalAIAlertsBundle=l,e.defaultOrd=(0,a.fold)(he.getMonoid())([(0,n.pipe)(he.ordBoolean,he.contramap((0,ue.ff)(o))),(0,n.pipe)(he.ordBoolean,he.contramap(H.m)),he.fromCompare(((e,t)=>i(e)&&i(t)?I.X.ord.compare(e,t):0))]),e.bundlesOrd=(0,a.fold)(he.getMonoid())([(0,n.pipe)(he.ordBoolean,he.contramap((0,ue.ff)(l))),(0,n.pipe)(he.ordBoolean,he.contramap(H.m)),he.fromCompare(((e,t)=>r(e)&&r(t)?ee.R.ord.compare(e,t):0))]),e.item=e=>ge.UI.Union.make("kind",{alertCard:Y.p.Card(e),alertsBundle:J.Q.Card(e),checklistItemEmpty:Z.z.Card(e),checklistItemWithAlerts:$.fw.Card(e),readersAttentionItem:W.Card}),e.viewState=d,e.createCardListFlow=e=>(0,K.sJ)((t=>(0,n.pipe)(e,me.tap((e=>e.actions.next(t.action)))))),e.listItemOrd=e=>he.contramap((e=>e.cell.item.view))(e).compare;const c={equals:(e,t)=>e.kind===t.kind&&ae.s.eqById.equals(e,t)},u=(e,t,i,s,a)=>({equals:(n,r)=>{const o={[I.X.Kind]:e,[ee.R.Kind]:t,[oe.X.kind]:i,[le.J.kind]:s,[H.g.kind]:a};return c.equals(n,r)&&function(e,t){return(i,s)=>t[e(i)].equals(i,s)}((e=>e.kind),o)(n,r)}}),m=(0,a.fold)(pe.getMonoid())([ne.o.eq,ae.s.verticalPositionEq,c]);function p(e,i){const s=I.X.Capabilities.getChangePosition(e);return{changePosition:e=>t(s.changePosition(e),ee.R.changePosition(e),oe.X.changePositionState(e),i.changePositionState(e),L.n$(e))}}function g(e,i,s){const a=I.X.Capabilities.getAnimatable(e),n=ee.R.Capabilities.getAnimatable(s);return{completeTransition:e=>t(a.completeTransition(e),n.completeTransition(e),oe.X.completeTransition(e),i.completeTransition(e),L.Xw(e)),transitionTo:e=>t(a.transitionTo(e),n.transitionTo(e),oe.X.transitionTo(e),i.transitionTo(e),L.uL(e)),changeVisualState:e=>t(a.changeVisualState(e),n.changeVisualState(e),oe.X.changeVisualState(e),i.changeVisualState(e),L.pR(e))}}function S(e,i,a,n,r){const o=ee.R.getCardHydrator(r),l=ee.R.getSelect(a,n,o),d=ee.R.getSelectByAlert(a,n,o),c=I.X.Capabilities.getSelect(e);return{select:(e,a,n)=>t(c.select(e,a,n),l(e,a),oe.X.select(e),i.selectFirstAlert((0,s.unsafeCoerce)(e),a),L.Ys(e,a)),selectByAlert:(e,a,n,r)=>t(c.selectByAlert(e,a,n,r),d(a,e,n),oe.X.select(e),i.selectByAlert(a,(0,s.unsafeCoerce)(e),n),s.identity),unselect:(e,a)=>t(c.unselect((0,s.unsafeCoerce)(e),a),ee.R.unselect((0,s.unsafeCoerce)(e),a),oe.X.unselect(e),i.unselect((0,s.unsafeCoerce)(e),a),L.hF(e,a))}}function v(e,a,n,o,l,d){return{removeAlertFromItem:(c,u)=>t((t=>I.X.Capabilities.getRemoveAlerts(e,u.itemsOrd)(c,de.In.getActiveItemOfType(i)(u))(t)),(e=>ee.R.Capabilities.getRemoveAlertsCapability(o,l,d,u.itemsOrd)(c,de.In.getActiveItemOfType(r)(u))(e)),s.identity,(e=>ie.G.getRemoveAlert(a,n,o).removeAlertFromItem(c,u)(e)),s.identity)}}function y(e,i,a,n){const r=I.X.Capabilities.getRemove(e);return{remove:(e,o)=>t(r.remove(e,o),(t=>e(t)?ee.R.Capabilities.getRemove(a,n)([t.activeAlert],o(t))(t):t),s.identity,(t=>e(t)?i.removeAlerts(t.alerts,o(t))(t):t),s.identity)}}function f(e,i,a,n){const r=I.X.Capabilities.getUpdateWithAlert(e),o=ee.R.Capabilities.getUpdatableWithAlertsCapability(i,n);return{updateWithAlerts:e=>t(r.updateWithAlerts(e),o(e),s.identity,a.updateWith(e),s.identity)}}e.equatable={structEq:u(I.X.eq,ee.R.eq,oe.X.eq,le.J.eq,H.g.eq),idEq:u(c,c,c,c,c),visualStateEq:u(m,m,m,m,m)},e.cloneable=()=>{const e=ae.s.Capabilities.getPojoCloneable().clone;return{clone:t(I.X.Capabilities.getCloneable().clone,e,e,e,e)}},e.changePosition=p,e.disposable={isScheduledToDispose:t((e=>se.C.willBeDisposed(e,e.removedAlertsIds)),(e=>se.C.willBeDisposed(e,e.removedAlertsIds)),s.constFalse,(e=>se.C.willBeDisposed(e,e.removedAlertsIds)),s.constFalse)},e.hidable={isHidden:t(ne.o.isHidden,ne.o.isHidden,ne.o.isHidden,ne.o.isHidden,ne.o.isHidden)},e.animatableItem=g,e.hasAlertsQueries={isSelectableByAlert:e=>t(se.C.hasAlert(e.alert.id),se.C.hasAlert(e.alert.id),s.constFalse,se.C.hasAlert(e.alert.id),s.constFalse),hasAlert:e=>t(se.C.hasAlert(e),se.C.hasAlert(e),s.constFalse,se.C.hasAlert(e),s.constFalse),hasActiveAlert:t((e=>h.some(e.activeAlert)),(e=>h.some(e.activeAlert)),(()=>h.none),(e=>h.some(e.activeAlert)),(()=>h.none))},e.changePositionStrategyQueries={useReferenceHeightOnRemove:t(s.constFalse,s.constFalse,s.constFalse,s.constTrue,s.constFalse)},e.select=S,e.removeAlert=v,e.remove=y,e.updateWithAlert=f,e.releaseAlert=(t,i,s,a,n,r)=>ce.v.Capabilities.getAlertReleaser({...v(t,i,s,a,n,r),...e.disposable}),e.unselectable=(e,t,i,s,a)=>ce.v.Capabilities.getUnselectable(de.In.getActiveItem,S(e,t,i,s,a)),e.selectableByAlert=(t,i,s,a,n)=>ce.v.Capabilities.getSelectableByAlert(de.In.getActiveItem,{...e.hasAlertsQueries,...S(t,i,s,a,n),...ce.v.Capabilities.getHasChecksFeed()}),e.selectableById=(e,t,i,s,a)=>ce.v.Capabilities.getSelectableById(de.In.getActiveItem,S(e,t,i,s,a)),e.updateMeta=()=>({updateMeta:ce.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=(e,t,i,s,a,n)=>ce.v.Capabilities.getAnimatable(e,{...v(e,t,i,s,a,n),...g(e,t,n),...ce.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=(t,i,s)=>ce.v.WithPriority.getHasPriorityToggle({...g(t,i,s),...e.hasAlertsQueries,...e.disposable});const C=t=>["focused","expanded"].includes(t.visualState.transition.type)&&!e.disposable.isScheduledToDispose(t);function b(e,i){const s=te.Mq.getCardSelections(i);return{nextAlert:t(s.nextAlert,s.nextAlert,(()=>h.none),e.nextAlert,(()=>h.none)),prevAlert:t(s.prevAlert,s.prevAlert,(()=>h.none),e.prevAlert,(()=>h.none))}}function A(){return{updateUserInput:e=>t(I.X.updateUserInput(e),ee.R.changeUserInput(e),s.identity,s.identity,s.identity)}}e.alignable={isValidToAlign:t(C,C,s.constFalse,C,s.constFalse)},e.alertIterator=b,e.itemReleaser=(e,t,i)=>ie.G.getItemReleaser(e,t,i,ce.v.Capabilities.getItemReleaser()),e.hasAlerts=ce.v.Capabilities.getHasAlerts,e.getDefaultNextAlertItemFilter=t=>(0,ue.W9)(e.isSelectableWithAlertItem,(i=>!e.disposable.isScheduledToDispose(i)&&(0,n.pipe)(i,e.hasAlertsQueries.hasActiveAlert,h.map((e=>t.isRegistered(e.id))),h.getOrElse(s.constFalse)))),e.hasUserInput=A,e.priorityTest=(0,ue.W9)(i,(e=>j.$.isPriority(e.activeAlert))),e.verifiable=()=>ce.v.Capabilities.getVerifiable(e.disposable),e.getCapabilities=function(t,i,a,n,r,o,l,c=(0,s.constant)(h.none),u=te.IG.Default){return{...d(c,l),...e.disposable,...e.hidable,...e.equatable,...A(),...e.cloneable(),...p(t,a),...g(t,a,r),...S(t,a,n,u,r),...y(t,a,u,r),...v(t,a,o,n,u,r),...f(t,i,a,r),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t,a,o,n,u,r),...e.unselectable(t,a,n,u,r),...e.selectableByAlert(t,a,n,u,r),...e.selectableById(t,a,n,u,r),...e.updateMeta(t),...e.animatableFeed(t,a,o,n,u,r),...e.hasPriorityToggle(t,a,r),...e.itemReleaser(a,o,n),...e.verifiable(),...e.hasAlerts(b(a,n),e.hasAlertsQueries,(()=>e.getDefaultNextAlertItemFilter(n)))}}}(G||(G={}))},20153:(e,t,i)=>{i.d(t,{n$:()=>d,pR:()=>c,uL:()=>u,Xw:()=>m,Ys:()=>p,hF:()=>h});var s=i(57050),a=i(40327),n=i(84313),r=i(48521),o=i(16892),l=i(5114);const d=e=>t=>({...t,positionState:e}),c=e=>t=>({...t,visualState:e}),u=e=>t=>({...t,visualState:r.o.VisualState.to(t.visualState,e)}),m=e=>t=>({...t,visualState:r.o.VisualState.complete(t.visualState,e)});function p(e,t){return i=>{const u=(0,a.pipe)(e,l.map((e=>t.compare(i,e)>0)),l.getOrElse(s.constTrue)),m=(0,a.pipe)(e,l.exists((e=>e.id===i.id))),p=m&&n.X.isCardOpen(i.visualState)?"expanded":"focused",h=(0,a.pipe)(e,l.fold((()=>r.o.VisualState.initial({type:p,clockwise:u})),(e=>r.o.VisualState.to(i.visualState,{type:p,clockwise:u}))));return(0,a.pipe)(i,m?s.identity:d(o.s.PositionState.invalidateHeight(i.positionState)),c(h))}}function h(e,t){return i=>{const n=(0,a.pipe)(e,l.map((e=>t.compare(i,e)>0)),l.getOrElse(s.constTrue)),u=(0,a.pipe)(e,l.exists((e=>e.id===i.id)));return(0,a.pipe)(i,u?s.identity:d(o.s.PositionState.invalidateHeight(i.positionState)),r.o.isHidden(i)?s.identity:c(r.o.VisualState.to(i.visualState,{type:"rendered",clockwise:n})))}}},65060:(e,t,i)=>{i.d(t,{g:()=>s,m:()=>m});var s,a=i(57050),n=i(2291),r=i(36156),o=i(16892),l=i(48521),d=i(4890),c=i(73975),u=i(5114);function m(e){return e.id===s.id}!function(e){e.id="ReadersAttentionItemId",e.kind="ReadersAttentionItem",e.eq=c.fromEquals(((e,t)=>e.hashCode()===t.hashCode()&&o.s.PositionState.eq.equals(e.positionState,t.positionState)&&l.o.VisualState.eq.equals(e.visualState,t.visualState))),e.hashCodeOwnFields=e=>(0,r.NO)({title:e.title,description:e.description,details:(0,a.pipe)(e.details,u.fold((()=>"none"),(e=>`some(${e})`))),attentionScore:n.T.prism.reverseGet(e.attentionScore)}),e.hashCode=e.hashCodeOwnFields,e.create=function(t,i,s){return{id:e.id,kind:e.kind,renderOptions:{...d.j.defaultOptions,layoutDensity:d.j.Density.minimal},positionState:i,visualState:s,title:t.title,description:t.description,details:t.details,attentionScore:t.attentionScore,equals(t){return e.eq.equals(this,t)},hashCode(){return e.hashCode(this)}}}}(s||(s={}))},16314:(e,t,i)=>{var s;function a(e){return e.type===s.miniCardClick}function n(e){return e.type===s.ignoreButtonClick}function r(e){return e.type===s.viewMoreButtonClick}function o(e){return e.type===s.feedbackButtonClick}i.d(t,{Dy:()=>s,Vl:()=>a,l9:()=>n,Q:()=>r,RJ:()=>o}),function(e){e.miniCardClick="readersAttentionItemMiniCardClick",e.ignoreButtonClick="readersAttentionItemIgnoreButtonClick",e.viewMoreButtonClick="readersAttentionItemViewMoreButtonClick",e.feedbackButtonClick="readersAttentionItemFeedbackButtonClick"}(s||(s={}))},35501:(e,t,i)=>{i.d(t,{h:()=>h,r:()=>g});var s=i(27378),a=i(63847),n=i(3656),r=i(77176),o=i(2291),l=i(8125),d=i(5739),c=i(12187),u=i(32821),m=i(35630);const p=({progress:e})=>s.createElement(d.F.Fragment,null,e.pipe(r.U((e=>s.createElement(a.P,{percentage:o.g.prism.reverseGet(e),colorType:a.P.ColorType.neoBlue,iconSize:a.P.IconSize.extraSmall,theme:{radialProgressBar:m.circleProgress,radialProgressText:m.circleText}}))))),h=e=>u.UI.Node.make((({view:t})=>s.createElement(d.F.div,{...(0,c.Sh)(m.header,t("density").pipe(r.U((e=>"normal"===e)),r.U((0,l.RN)(m.normal,m.compact))))},s.createElement("div",{className:m.progressIcon},s.createElement(p,{progress:t("attentionScore").pipe(r.U(o.g.fromRatio))})),s.createElement(n.XY,{...(0,c.Sh)(m.title,"full"===e?m.full:void 0)},t("title"))))),g=u.UI.Node.make((({view:e})=>s.createElement(s.Fragment,null,s.createElement("div",{className:m.progressContainer,"data-name":"attention-score-progress-bar"},s.createElement(d.F.div,{className:m.progressBar,style:{width:e("attentionScore").pipe(r.U(o.g.fromRatio),r.U(o.g.prism.reverseGet),r.U((e=>`${e}%`)))}},s.createElement(n.XY,{className:m.progressValue,"data-name":"attention-score-progress-value"},e("attentionScore").pipe(r.U(o.g.fromRatio),r.U(o.g.prism.reverseGet),r.U((e=>`${e}%`)))))),s.createElement(n.XY,{className:m.description},e("description")))))},56989:(e,t,i)=>{i.r(t),i.d(t,{ShortenItFeature:()=>J});var s,a=i(57050),n=i(74850),r=i(80864),o=i(5817),l=i(19751),d=i(85985),c=i(66310),u=i(80900),m=i(17343),p=i(93508),h=i(28043),g=i(76974),S=i(38983);!function(e){e.disconnected="disconnected",e.sessionStarted="sessionStarted",e.checking="checking",e.idle="idle"}(s||(s={}));class v{constructor(e,t){this._textObserver=e,this._requestAwaitService=t,this._logger=n.Y.create("ShortenItRequestManager"),this._sessionState=S.h.create({kind:s.sessionStarted}),this._typingDebounceDelay=(0,o.m9)(1),this._typingPaused=this._textObserver.contentChanges.async.pipe(d.h((e=>e.changes.length>0)),c.w((()=>u.H(this._typingDebounceDelay).pipe(m.h(!0),p.O(!1)))),p.O(!0),h.x(),l.d({bufferSize:1,refCount:!0}))}_flush(){this._logger.debug("flushing changes"),this._requestAwaitService.addRequest(Promise.resolve())}canSubmitRequest(){return this._typingPaused.pipe(c.w((e=>e?(this._flush(),u.H(500).pipe(c.w((()=>this._sessionState.view((e=>e.kind===s.idle)))))):g.of(!1))))}onNewRemoteRevision(e){e.sessionJustStarted&&this._onCAPISessionStarted(),this._sessionState.get().kind!==s.checking&&this._logger.trace("checking in progress"),this._sessionState.set({kind:s.checking,lastRevision:e.revision})}onRevisionFinished(e){const t=this._sessionState.get();t.kind===s.checking&&t.lastRevision===e&&(this._logger.trace("checking idle"),this._sessionState.set({kind:s.idle}))}onDisconnect(){this._logger.debug("websocket disconnected"),this._sessionState.set({kind:s.disconnected})}_onCAPISessionStarted(){this._logger.debug("session started"),this._sessionState.set({kind:s.sessionStarted})}}var y,f=i(17404),C=i(40018),b=i(14601),I=i(32952),A=i(77176),k=i(23063),w=i(24209),_=i(5114),E=i(71249);!function(e){e.isReceived=function(e){return e.kind===C.vQ.SummaryState.received},e.isNotFound=function(e){return e.kind===C.vQ.SummaryState.notFound}}(y||(y={}));class R{constructor(e,t){this._alertProcessor=e,this._textObserver=t,this._logger=n.Y.create("ShortenItRequestStateHolder"),this._subs=new b.w,this._summaryRequestState=new Map,this._summaryNotFound=new I.xQ,this._staleRequests=new Map,this._textChangedBeforeSummaryReceived=new I.xQ,this.summaryNotFound=this._summaryNotFound.asObservable(),this.textChangedBeforeSummaryReceived=this._textChangedBeforeSummaryReceived.asObservable(),this._trackSummaryReceived(),this._trackTextChanges()}_trackTextChanges(){this._subs.add(this._textObserver.contentChanges.async.subscribe((e=>{if(!e.deltaChange.isEmpty)for(const e of this._staleRequests.keys())this._staleRequests.set(e,!0)})))}onCAPISessionStarted(){this._summaryRequestState.clear(),this._staleRequests.clear()}onShortenItFinished(e){const t=this._summaryRequestState.get(e);if((null==t?void 0:t.kind)!==C.vQ.SummaryState.received){if(!0===this._staleRequests.get(e))return this._logger.info("request stale",e),void this._textChangedBeforeSummaryReceived.next(e);this._logger.info("summary not found",e),this._summaryRequestState.set(e,{kind:C.vQ.SummaryState.notFound,latency:(0,a.pipe)(_.fromNullable(this._summaryRequestState.get(e)),_.fold((()=>0),(e=>{switch(e.kind){case C.vQ.SummaryState.requestSent:return performance.now()-e.requestTimestamp;case C.vQ.SummaryState.notFound:return e.latency;default:return 0}})))}),this._summaryNotFound.next(e)}else this._staleRequests.delete(e)}onShortenItSubmit(e){this._staleRequests.set(e,!1),this._summaryRequestState.set(e,{kind:C.vQ.SummaryState.requestSent,requestTimestamp:performance.now()})}get(e){return _.fromNullable(this._summaryRequestState.get(e))}_trackSummaryReceived(){const e=this._alertProcessor.alerts.state.pipe(A.U((0,a.flow)(Object.values,Array.from,E.filter(f.S.isShortenItAlertWithSummary))),k.q(1)),t=this._alertProcessor.alerts.changes.pipe(A.U((e=>e.addedAlerts.concat(e.updatedAlerts).filter(f.S.isShortenItAlertWithSummary))));this._subs.add(w.T(e,t).subscribe((e=>{e.forEach((e=>{const t=e.id;this._logger.info("summary received",t),this._summaryRequestState.set(t,{kind:C.vQ.SummaryState.received,latency:(0,a.pipe)(_.fromNullable(this._summaryRequestState.get(t)),_.fold((()=>0),(e=>{switch(e.kind){case C.vQ.SummaryState.requestSent:return performance.now()-e.requestTimestamp;case C.vQ.SummaryState.received:return e.latency;default:return 0}})))})}))})))}dispose(){this._subs.unsubscribe()}}var q=i(2291),T=i(15646),F=i(75316),O=i(35416),U=i(60797),B=i(16118),N=i(67434),x=i(85321),D=i(13444),P=i(22232),Q=i(83078),H=i(8125),M=i(73975);function X(e){switch(e){case C.vQ.SummaryState.notRequested:case C.vQ.SummaryState.requestSent:case C.vQ.SummaryState.invalidated:return"AILoadingCard";case C.vQ.SummaryState.received:return"summaryCard";case C.vQ.SummaryState.notFound:return"errorCard";default:(0,P.vE)(e)}}class V{constructor(e,t,i){this._gnar=e,this._getSessionUuid=t,this._getRequestState=i}initAssistantTracking(e,t,i,s){const n=new b.w,o=new Map,c=new Map;return n.add(function(e,t){return e.pipe(d.h((0,H.Kg)(T.lY.isAlertIgnoreAction,T.lY.isAlertApplyAction)),A.U((e=>(0,a.pipe)(t.getById(e.alertId),_.filter(C.bZ.isShortenIt),_.map((()=>e))))),U.oA)}(e,t).subscribe((e=>{switch(e.type){case T.lY.Type.alertIgnore:o.set(e.alertId,"dismissed");break;case T.lY.Type.alertApply:o.set(e.alertId,"accepted");break;default:(0,P.vE)(e)}}))),n.add(e.pipe(d.h((0,H.Kg)(T.ut.isReviewEdit,T.ut.isDismissEdit))).subscribe((e=>{const t=c.get(e.alertId)||{numEditsDismissed:0,numEditsReviewed:0,numTotalEditsDismissed:0,numTotalEditsReviewed:0};switch(e.type){case T.lY.Type.shortenItReviewEdit:c.set(e.alertId,{...t,numEditsReviewed:t.numEditsReviewed+1,numTotalEditsReviewed:t.numTotalEditsReviewed+1});break;case T.lY.Type.shortenItDismissEdit:c.set(e.alertId,{...t,numEditsDismissed:t.numEditsDismissed+1,numTotalEditsDismissed:t.numTotalEditsDismissed+1});break;default:(0,P.vE)(e)}}))),n.add(function(e,t,i,s,n,o){return w.T(t.pipe(A.U(_.some)),i.pipe(m.h(_.none))).pipe(A.U(_.chain((t=>O.nL.hasItems(t)?(0,a.pipe)(r.O.getActiveItemWithAlert(t.currentLens),_.filter(F.C.isShortenItItem),_.map((e=>e.activeAlert)),_.chain((t=>(0,a.pipe)(e.getById(t.id),_.chain(C.bZ.getRawId),_.map((e=>({alert:t,rawAlertId:e}))))))):_.none))),l.$f(_.getEq(M.contramap((e=>({id:e.alert.id,activeView:X(e.alert.summaryState)})))(M.getStructEq({id:M.eqString,activeView:M.eqString})))),p.O(_.none),B.G(),N.R((({focusTimestamp:e},[t,i])=>{const r=(0,a.pipe)(t,_.map((e=>e.alert.id)),_.fold(a.constFalse,(e=>(0,a.pipe)(i,_.map((e=>e.alert.id)),Q.contains(e))))),l=(0,a.pipe)(i,_.map((e=>e.alert.summaryState)),Q.contains(C.vQ.SummaryState.received)),d=(0,a.pipe)(i,_.map((e=>e.alert.summaryState)),Q.contains(C.vQ.SummaryState.notFound)),c=[];return(0,a.pipe)(t,Q.tap((t=>{const i=t.alert.summaryState===C.vQ.SummaryState.received,s=t.alert.summaryState===C.vQ.SummaryState.notFound,u=_.toNullable(n(t.alert.id))||"unfocused";if(s)(0,P.kG)("accepted"!==u,"Can't accept a ShortenIt alert that timed-out"),c.push({kind:"summaryNotFoundHide",alertId:t.alert.id,reason:u,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount});else if(i){const e=o(t.alert.id);c.push({kind:"summaryAlertHide",alertId:t.alert.id,reason:u,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount,compressionRatio:q.T.unwrap(t.alert.compressionRatio),canDismissEdits:t.alert.canDismissEdits,numEditsReviewed:(0,a.pipe)(e,_.fold((()=>0),(e=>e.numEditsReviewed))),numEditsDismissed:(0,a.pipe)(e,_.fold((()=>0),(e=>e.numEditsDismissed))),numTotalEditsDismissed:(0,a.pipe)(e,_.fold((()=>0),(e=>e.numTotalEditsDismissed))),numTotalEditsReviewed:(0,a.pipe)(e,_.fold((()=>0),(e=>e.numTotalEditsReviewed))),numOriginalEdits:t.alert.transformGroups.size,numEditsOnOpen:t.alert.transformGroups.size-(0,a.pipe)(e,_.fold((()=>0),(e=>e.numTotalEditsDismissed-e.numEditsDismissed)))})}else(0,P.kG)("accepted"!==u,"Can't accept a loading ShortenIt alert"),c.push({kind:"summaryAlertLoadingHide",alertId:t.alert.id,reason:l&&r?"summaryReceived":d&&r?"timeoutReceived":u,duration:performance.now()-e,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount})}))),(0,a.pipe)(i,Q.tap((e=>{if(d)c.push({kind:"summaryNotFoundShow",alertId:e.alert.id,reason:r?"timeoutReceived":"focused",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount,latency:(0,a.pipe)(s(e.rawAlertId),_.getOrElse((()=>0)))});else if(l){const t=o(e.alert.id);c.push({kind:"summaryAlertShow",alertId:e.alert.id,reason:r?"summaryReceived":"focused",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount,compressionRatio:q.T.unwrap(e.alert.compressionRatio),canDismissEdits:e.alert.canDismissEdits,numOriginalEdits:e.alert.transformGroups.size,numEditsOnOpen:e.alert.transformGroups.size-e.alert.dismissedTransformGroups.size,numTotalEditsDismissed:(0,a.pipe)(t,_.fold((()=>0),(e=>e.numTotalEditsDismissed))),numTotalEditsReviewed:(0,a.pipe)(t,_.fold((()=>0),(e=>e.numTotalEditsReviewed))),latency:(0,a.pipe)(s(e.rawAlertId),_.getOrElse((()=>0)))})}else c.push({kind:"summaryAlertLoadingShow",alertId:e.alert.id,sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount})}))),{events:c,focusTimestamp:performance.now()}}),{events:[],focusTimestamp:performance.now()}),A.U((e=>e.events)),x.zg(a.identity))}(t,i.pipe(D.g(100)),s,(e=>(0,a.pipe)(this._getRequestState(e),_.filter((0,H.Kg)(y.isReceived,y.isNotFound)),_.map((e=>e.latency)))),(e=>_.fromNullable(o.get(e))),(e=>_.fromNullable(c.get(e)))).subscribe((e=>{if(function(e,t,i){switch(t.kind){case"summaryAlertShow":e.shortenItSummaryShow(t.alertId,t.canDismissEdits,t.compressionRatio,t.latency,t.sentenceCount,t.wordCount,t.numEditsOnOpen,t.numOriginalEdits,t.numTotalEditsDismissed,t.numTotalEditsReviewed,i,t.reason);break;case"summaryAlertHide":e.shortenItSummaryHide(t.alertId,t.canDismissEdits,t.compressionRatio,t.reason,t.sentenceCount,t.wordCount,t.numEditsDismissed,t.numEditsOnOpen,t.numEditsReviewed,t.numOriginalEdits,t.numTotalEditsDismissed,t.numTotalEditsReviewed,i);break;case"summaryAlertLoadingShow":e.shortenItSummaryLoadingShow(t.alertId,t.sentenceCount,t.wordCount,i);break;case"summaryAlertLoadingHide":e.shortenItSummaryLoadingHide(t.alertId,t.reason,t.sentenceCount,t.wordCount,t.duration,i);break;case"summaryNotFoundShow":e.shortenItSummaryNotFoundShow(t.alertId,t.latency,t.sentenceCount,t.wordCount,i,t.reason);break;case"summaryNotFoundHide":e.shortenItSummaryNotFoundHide(t.alertId,t.reason,t.sentenceCount,t.wordCount,i);break;default:(0,P.vE)(t)}}(this._gnar,e,(0,a.pipe)(this._getSessionUuid(),_.getOrElse((()=>"")))),"summaryAlertHide"===e.kind){const t=c.get(e.alertId)||{numEditsDismissed:0,numEditsReviewed:0,numTotalEditsDismissed:0,numTotalEditsReviewed:0};c.set(e.alertId,{...t,numEditsReviewed:0,numEditsDismissed:0})}}))),n}}var W=i(84966),G=i(79227),L=i(4390),z=i(44586),Y=i(40151),K=i(78674);class J{constructor(e,t,i,s,a){this._alertProcessor=e,this._textObserver=t,this._requestAwaitService=i,this._getSessionUuid=s,this._gnar=a,this._logger=n.Y.create("ShortenItFeature"),this._requestState=new R(this._alertProcessor,this._textObserver),this._requestManager=new v(this._textObserver,this._requestAwaitService),this._gnarTracking=new V(this._gnar,this._getSessionUuid,(e=>this._requestState.get(e)))}get addStateToRawAlertTransformer(){return e=>{if(W.wQ.isShortenIt(e)){const t=_.toNullable(this._requestState.get(e.id));return{...e,extra_properties:{...e.extra_properties,shorten_it_alert_state:{summaryState:null==t?void 0:t.kind}}}}return e}}onShortenItFinished(e){this._requestState.onShortenItFinished(e)}onNewRemoteRevision(e){e.sessionJustStarted&&this._requestState.onCAPISessionStarted(),this._requestManager.onNewRemoteRevision(e)}onRevisionFinished(e){this._requestManager.onRevisionFinished(e)}onDisconnect(){this._requestManager.onDisconnect()}initAssistantSession(e,t,i,s,n){return new z.y((()=>{const u=new b.w,p=new I.xQ;return u.add(w.T(function(e,t=(0,o.m9)(.5)){return e.pipe(A.U((e=>O.nL.hasItems(e)?(0,a.pipe)(r.O.getActiveItemWithAlert(e.currentLens),_.filter(F.C.isShortenItItem),_.filter((e=>e.activeAlert.summaryState===C.vQ.SummaryState.notRequested||e.activeAlert.summaryState===C.vQ.SummaryState.invalidated)),_.map((e=>e.activeAlert.id))):_.none)),l.$f(_.getEq(M.eqString)),K.b(t))}(i),this._requestState.textChangedBeforeSummaryReceived.pipe(Z(n))).pipe(c.w(_.fold((()=>Y.E),(e=>this._requestManager.canSubmitRequest().pipe(d.h((e=>!0===e)),k.q(1),m.h(e)))))).subscribe((e=>{this._logger.info("submitting request for",e),s.sendShortenItSummaryRequest(e),(0,a.pipe)(t.getById(e),_.chain(C.bZ.getRawId),Q.tap((e=>this._requestState.onShortenItSubmit(e))))}))),u.add(this._requestState.summaryNotFound.pipe(Z(n),U.oA).subscribe((e=>s.shortenItSummaryNotFound(e)))),u.add(this._requestState.summaryNotFound.pipe(Z(n),U.oA,D.g(1500)).subscribe((e=>s.applyFeedback(e,{kind:W.PZ.HIDE,subtype:G.J.getSubTypeFromLens(i.get().currentLens.id)},C.l$.api)))),u.add(this._gnarTracking.initAssistantTracking(e,t,i,p)),()=>{p.next(),u.unsubscribe()}}))}dispose(){this._requestState.dispose()}}function Z(e){return A.U((t=>(0,a.pipe)(e.get(),L.p.find((e=>(0,a.pipe)(C.bZ.getRawId(e.alert),Q.contains(t)))),_.map((e=>e.alert.id)))))}},35630:e=>{e.exports={circleProgress:"_1npo5",circleText:"_3muDd",card:"AAT_T",header:"_3k6P5",compact:"_1Efs0",normal:"_2_T8O",progressIcon:"_3lupT",title:"_1U6tn",full:"_24i7N",progressContainer:"TH-Um",progressBar:"_1Tzvc",progressValue:"_1Ck8G",description:"_4m_YN"}},32585:e=>{e.exports={cardBody:"_1qMrW",description:"_3g_X-",actions:"G0xen",lessIcon:"_3HhMd",minimalDescription:"srN6O",actionsFooter:"_11uNl",feedbackFooter:"_2PAOt",viewMoreButton:"_1CGEL"}},11510:e=>{e.exports={miniCard:"_2FMyP"}}}]);